<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Usuarios - Cooperativa Agrícola La Pintada</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🌱</text></svg>">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="css/dashboard.css" rel="stylesheet">
    <link rel="stylesheet" href="css/search.css">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-seedling"></i>
                </div>
                <h1>Cooperativa</h1>
            </div>
            <button class="toggle-sidebar" id="toggleSidebar">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        
        <nav class="sidebar-nav">
            <ul class="nav-list">
                <li class="nav-item">
                    <a href="dashboard.html" class="nav-link">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="socios.html" class="nav-link">
                        <i class="fas fa-users"></i>
                        <span>Socios</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="ventas.html" class="nav-link">
                        <i class="fas fa-shopping-cart"></i>
                        <span>Ventas</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="pagos.html" class="nav-link">
                        <i class="fas fa-credit-card"></i>
                        <span>Pagos</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="produccion.html" class="nav-link">
                        <i class="fas fa-seedling"></i>
                        <span>Producción</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="insumos.html" class="nav-link">
                        <i class="fas fa-boxes"></i>
                        <span>Insumos</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="reportes.html" class="nav-link">
                        <i class="fas fa-chart-bar"></i>
                        <span>Reportes</span>
                    </a>
                </li>
                <li class="nav-item active">
                    <a href="usuarios.html" class="nav-link">
                        <i class="fas fa-user-cog"></i>
                        <span>Usuarios</span>
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1><i class="fas fa-user-cog"></i> Gestión de Usuarios</h1>
                <p>Administración de usuarios y permisos del sistema</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="mostrarModalNuevoUsuario()">
                    <i class="fas fa-plus"></i> Nuevo Usuario
                </button>
                <button class="btn btn-secondary" onclick="actualizarDatos()">
                    <i class="fas fa-sync"></i> Actualizar
                </button>
            </div>
        </header>

        <!-- Estadísticas -->
        <section class="stats-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalUsuarios">0</h3>
                        <p>Total Usuarios</p>
                        <span class="stat-subtitle">Registrados en el sistema</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon active">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="usuariosActivos">0</h3>
                        <p>Usuarios Activos</p>
                        <span class="stat-subtitle">Con acceso al sistema</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon admin">
                        <i class="fas fa-crown"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="administradores">0</h3>
                        <p>Administradores</p>
                        <span class="stat-subtitle">Con permisos completos</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon producer">
                        <i class="fas fa-seedling"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="productores">0</h3>
                        <p>Productores</p>
                        <span class="stat-subtitle">Usuarios productores</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Roles y Permisos -->
        <section class="roles-section">
            <h2><i class="fas fa-shield-alt"></i> Roles y Permisos</h2>
            <div class="roles-grid">
                <div class="role-card admin">
                    <div class="role-header">
                        <i class="fas fa-crown"></i>
                        <h3>Administrador</h3>
                        <span class="role-badge">Acceso completo al sistema</span>
                    </div>
                    <div class="role-permissions">
                        <h4>Permisos:</h4>
                        <ul>
                            <li>Gestión de usuarios</li>
                            <li>Todos los módulos</li>
                            <li>Configuración del sistema</li>
                        </ul>
                    </div>
                </div>
                
                <div class="role-card producer">
                    <div class="role-header">
                        <i class="fas fa-seedling"></i>
                        <h3>Productor</h3>
                        <span class="role-badge">Acceso limitado para productores</span>
                    </div>
                    <div class="role-permissions">
                        <h4>Permisos:</h4>
                        <ul>
                            <li>Ver producción propia</li>
                            <li>Registrar cosechas</li>
                            <li>Ver pagos</li>
                        </ul>
                    </div>
                </div>
                
                <div class="role-card client">
                    <div class="role-header">
                        <i class="fas fa-shopping-cart"></i>
                        <h3>Cliente</h3>
                        <span class="role-badge">Acceso para compradores</span>
                    </div>
                    <div class="role-permissions">
                        <h4>Permisos:</h4>
                        <ul>
                            <li>Ver catálogo</li>
                            <li>Realizar pedidos</li>
                            <li>Ver facturas</li>
                        </ul>
                    </div>
                </div>
                
                <div class="role-card accountant">
                    <div class="role-header">
                        <i class="fas fa-calculator"></i>
                        <h3>Contador</h3>
                        <span class="role-badge">Acceso a módulos financieros</span>
                    </div>
                    <div class="role-permissions">
                        <h4>Permisos:</h4>
                        <ul>
                            <li>Gestión financiera</li>
                            <li>Reportes</li>
                            <li>Pagos y aportes</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Lista de Usuarios -->
        <section class="users-section">
            <div class="section-header">
                <h2><i class="fas fa-list"></i> Lista de Usuarios</h2>
                <div class="filters">
                    <select id="filtroRol" onchange="filtrarUsuarios()">
                        <option value="">Todos los roles</option>
                        <option value="administrador">Administradores</option>
                        <option value="productor">Productores</option>
                        <option value="cliente">Clientes</option>
                        <option value="contador">Contadores</option>
                    </select>
                    <select id="filtroEstado" onchange="filtrarUsuarios()">
                        <option value="">Todos los estados</option>
                        <option value="activo">Activos</option>
                        <option value="inactivo">Inactivos</option>
                        <option value="suspendido">Suspendidos</option>
                    </select>
                </div>
            </div>
            
            <div class="users-table-container">
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>Usuario</th>
                            <th>Rol</th>
                            <th>Estado</th>
                            <th>Último Acceso</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="usuariosTableBody">
                        <tr>
                            <td colspan="5" class="loading">
                                <i class="fas fa-spinner fa-spin"></i> Cargando usuarios...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- Modal Nuevo Usuario -->
    <div id="modalNuevoUsuario" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> Nuevo Usuario</h3>
                <button class="close" onclick="cerrarModal('modalNuevoUsuario')">&times;</button>
            </div>
            <form id="formNuevoUsuario" onsubmit="crearUsuario(event)">
                <div class="form-group">
                    <label for="nombre">Nombre *</label>
                    <input type="text" id="nombre" name="nombre" required>
                </div>
                <div class="form-group">
                    <label for="apellido">Apellido *</label>
                    <input type="text" id="apellido" name="apellido" required>
                </div>
                <div class="form-group">
                    <label for="email">Email *</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="telefono">Teléfono</label>
                    <input type="tel" id="telefono" name="telefono">
                </div>
                <div class="form-group">
                    <label for="username">Nombre de Usuario *</label>
                    <input type="text" id="username" name="username" required>
                </div>
                <div class="form-group">
                    <label for="password">Contraseña *</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <div class="form-group">
                    <label for="rol">Rol *</label>
                    <select id="rol" name="rol" required>
                        <option value="">Seleccionar rol</option>
                        <option value="administrador">Administrador</option>
                        <option value="productor">Productor</option>
                        <option value="cliente">Cliente</option>
                        <option value="contador">Contador</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="estado">Estado</label>
                    <select id="estado" name="estado">
                        <option value="activo">Activo</option>
                        <option value="inactivo">Inactivo</option>
                        <option value="suspendido">Suspendido</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="notas">Notas</label>
                    <textarea id="notas" name="notas" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="cerrarModal('modalNuevoUsuario')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Crear Usuario</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Editar Usuario -->
    <div id="modalEditarUsuario" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-edit"></i> Editar Usuario</h3>
                <button class="close" onclick="cerrarModal('modalEditarUsuario')">&times;</button>
            </div>
            <form id="formEditarUsuario" onsubmit="actualizarUsuario(event)">
                <input type="hidden" id="editId" name="id_usuario">
                <div class="form-group">
                    <label for="editNombre">Nombre *</label>
                    <input type="text" id="editNombre" name="nombre" required>
                </div>
                <div class="form-group">
                    <label for="editApellido">Apellido *</label>
                    <input type="text" id="editApellido" name="apellido" required>
                </div>
                <div class="form-group">
                    <label for="editEmail">Email *</label>
                    <input type="email" id="editEmail" name="email" required>
                </div>
                <div class="form-group">
                    <label for="editTelefono">Teléfono</label>
                    <input type="tel" id="editTelefono" name="telefono">
                </div>
                <div class="form-group">
                    <label for="editUsername">Nombre de Usuario *</label>
                    <input type="text" id="editUsername" name="username" required>
                </div>
                <div class="form-group">
                    <label for="editPassword">Nueva Contraseña (dejar vacío para mantener la actual)</label>
                    <input type="password" id="editPassword" name="password">
                </div>
                <div class="form-group">
                    <label for="editRol">Rol *</label>
                    <select id="editRol" name="rol" required>
                        <option value="administrador">Administrador</option>
                        <option value="productor">Productor</option>
                        <option value="cliente">Cliente</option>
                        <option value="contador">Contador</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editEstado">Estado</label>
                    <select id="editEstado" name="estado">
                        <option value="activo">Activo</option>
                        <option value="inactivo">Inactivo</option>
                        <option value="suspendido">Suspendido</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editNotas">Notas</label>
                    <textarea id="editNotas" name="notas" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="cerrarModal('modalEditarUsuario')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Actualizar Usuario</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/usuarios.js"></script>
</body>
</html>